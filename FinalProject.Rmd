---
title: "ClassWork1106"
author: "Akanksha Rai"
date: "2025-11-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Step 0: What's the point, what, why ?

### Step 1 - Read Data

```{r}
marketing_campaign <- read.csv("marketing_campaign.csv", sep = "\t", stringsAsFactors = TRUE)
summary(marketing_campaign)
```

### Step 2: Clean data

```{r}
marketing_campaign$Income <- ifelse(is.na(marketing_campaign$Income), 
                                    mean(marketing_campaign$Income, na.rm = T), marketing_campaign$Income)

marketing_campaign$Dt_Customer <- as.character(marketing_campaign$Dt_Customer)

marketing_campaign$Year_Customer <- substr(marketing_campaign$Dt_Customer, 
                                  nchar(marketing_campaign$Dt_Customer) - 3, 
                                  nchar(marketing_campaign$Dt_Customer))

marketing_campaign$Dt_Customer <- NULL
marketing_campaign$ID <- NULL

marketing_campaign$Year_Customer <- as.factor(marketing_campaign$Year_Customer)

marketing_campaign$Z_CostContact <- NULL
marketing_campaign$Z_Revenue <- NULL

summary(marketing_campaign)

marketing_campaign_dummies <- as.data.frame(model.matrix(~ . -1, data = marketing_campaign))

minmax <- function(x){
  (x - min(x))/(max(x) - min(x))
}

marketing_s <- as.data.frame(lapply(marketing_campaign_dummies, minmax))

```

### Step 3 - Train/Test Split

```{r}
train_ratio <- 0.5
set.seed(12345)
train_rows <- sample(1:nrow(marketing_s), train_ratio*nrow(marketing_s))

marketing_train <- marketing_s[train_rows, ]
marketing_test <- marketing_s[-train_rows, ]

```

Our team has build the individual models in separate files for cleanness. For each individual model, we try to improve the model as much as we can. This way we get to combine the best result into our second level model, ensuring for a final model that has the best performance.

Here's what we will use toward the second level model from the individual model

-   Logistic Regression: "lr_prob_interactions"

-   KNN Model: "knn_prob_1"

-   ANN Model: "ann_probs"

-   Decision Tree: "dtree_probs_1"

-   SVM: "svm_probs_1"

-   Random Forest: "rf_prob_1"

### Step 4 & 5: Stacked Model 

```{r}
combined <- data.frame(
  glm = as.numeric(lr_prob_interactions),
  knn = as.numeric(knn_prob_1),
  ann = as.numeric(ann_probs),
  dtree = as.numeric(dtree_probs_1),
  svm = as.numeric(svm_probs_1),
  rf = as.numeric(rf_prob_1),
  actual = as.numeric(marketing_test$Response)
)
```

```{r}
set.seed(12345)
combine_index <- sample(1:nrow(combined), 0.7 * nrow(combined))
combined_train <- combined[combine_index, ]
combined_test  <- combined[-combine_index, ]
```


```{r}
stacked_model <- C5.0(as.factor(actual) ~ ., data = combined_train)
summary(stacked_model)

plot(stacked_model)
```

```{r}
stacked_pred <- predict(stacked_model, combined_test)

confusionMatrix(as.factor(stacked_pred), as.factor(combined_test$actual), positive = "1")
```
Cost Matrix: Our marketing campaign is target towards the true positive. Thus we want to increase the number as much as possible. To do this we will be using a cost matrix, putting a heavier cost on the false negative. 

```{r, warning = FALSE }
cost_01_values <- c(1, 2, 3)   
cost_10_values <- c(2,3,4, 5, 6)  

results <- data.frame(cost_01 = numeric(),
                      cost_10 = numeric(),
                      Accuracy = numeric(),
                      Kappa = numeric(),
                      Sensitivity = numeric())

for (c01 in cost_01_values) {
  for (c10 in cost_10_values) {
    if (c10 > c01) {
      cost_matrix <- matrix(c(0, c01,
                              c10, 0), nrow = 2)
      cost_model <- C5.0(as.factor(actual) ~ ., data = combined_train, cost = cost_matrix)
      pred <- predict(cost_model, combined_test)
      cm <- confusionMatrix(as.factor(pred), as.factor(combined_test$actual), positive = "1")
      results <- rbind(results, data.frame(cost_01 = c01,
                                           cost_10 = c10,
                                           Accuracy = cm$overall['Accuracy'],
                                           Kappa = cm$overall['Kappa'],
                                           Sensitivity = cm$byClass['Sensitivity']))
    }
  }
}

print(results)
```

```{r}
#Cost Matrix 
cost_matrix <- matrix(c(0,1,4,0), nrow = 2)

#Cost Model 
cost_stacked <- C5.0(as.factor(actual) ~ ., data = combined_train, cost = cost_matrix)

plot(cost_stacked)

cost_pred <- predict(cost_stacked, combined_test)
cost_cm <- confusionMatrix(as.factor(cost_pred), as.factor(combined_test$actual), positive = "1")
cost_cm
```























