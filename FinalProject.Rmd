---
title: "ClassWork1106"
author: "Akanksha Rai"
date: "2025-11-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Step 0: What's the point, what, why ?

### Step 1 - Read Data

```{r}
marketing_campaign <- read.csv("marketing_campaign.csv", sep = "\t", stringsAsFactors = TRUE)
summary(marketing_campaign)
```

### Step 2: Clean data

```{r}
marketing_campaign$Income <- ifelse(is.na(marketing_campaign$Income), 
                                    mean(marketing_campaign$Income, na.rm = T), marketing_campaign$Income)

marketing_campaign$Dt_Customer <- as.character(marketing_campaign$Dt_Customer)

marketing_campaign$Year_Customer <- substr(marketing_campaign$Dt_Customer, 
                                  nchar(marketing_campaign$Dt_Customer) - 3, 
                                  nchar(marketing_campaign$Dt_Customer))

marketing_campaign$Dt_Customer <- NULL
marketing_campaign$ID <- NULL

marketing_campaign$Year_Customer <- as.factor(marketing_campaign$Year_Customer)

marketing_campaign$Z_CostContact <- NULL
marketing_campaign$Z_Revenue <- NULL

summary(marketing_campaign)

marketing_campaign_dummies <- as.data.frame(model.matrix(~ . -1, data = marketing_campaign))

minmax <- function(x){
  (x - min(x))/(max(x) - min(x))
}

marketing_s <- as.data.frame(lapply(marketing_campaign_dummies, minmax))

```

### Step 3 - Train/Test Split

```{r}
train_ratio <- 0.5
set.seed(12345)
train_rows <- sample(1:nrow(marketing_s), train_ratio*nrow(marketing_s))

marketing_train <- marketing_s[train_rows, ]
marketing_test <- marketing_s[-train_rows, ]

```

Our team has build the individual models in separate files for cleanness. For each individual model, we try to improve the model as much as we can. This way we get to combine the best result into our second level model, ensuring for a final model that has the best performance.

Here's what we will use toward the second level model from the individual model

-   Logistic Regression: "lr_prob_interactions"

-   KNN Model: "knn_prob_1"

-   ANN Model: "ann_probs"

-   Decision Tree: "dtree_probs_1"

-   SVM: "svm_probs_1"

-   Random Forest: "rf_prob_1"

### Step 4 & 5: Stacked Model 

```{r}
combined <- data.frame(
  glm = as.numeric(lr_prob_interactions),
  knn = as.numeric(knn_prob_1),
  ann = as.numeric(ann_probs),
  dtree = as.numeric(dtree_probs_1),
  svm = as.numeric(svm_probs_1),
  rf = as.numeric(rf_prob_1),
  actual = as.numeric(marketing_train$Response)
)
```

```{r}
set.seed(12345)
combine_index <- sample(1:nrow(combined), 0.7 * nrow(combined))
combined_train <- combined[combine_index, ]
combined_test  <- combined[-combine_index, ]
```


```{r}
stacked_model <- C5.0(as.factor(actual) ~ ., data = combined_train)
summary(stacked_model)

plot(stacked_model)
```

```{r}
stacked_pred <- predict(stacked_model, combined_test)

confusionMatrix(as.factor(stacked_pred), as.factor(combined_test$actual), positive = "1")
```

