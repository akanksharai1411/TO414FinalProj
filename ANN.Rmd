---
title: "ANN Model"
author: "Anish"
date: "2025-12-02"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("tidyverse")
library(neuralnet)
library(caret)
library(class)
library(C50)
library(knitr)
library(kableExtra)
library(kernlab)
library(randomForest)
```

This is the file for the ANN model. 

### Step 2 - Read Data
```{r}
marketing_campaign <- read.csv("marketing_campaign.csv", sep = "\t", stringsAsFactors = TRUE)
summary(marketing_campaign)
```


##Step 3 - Clean data
```{r}
marketing_campaign$Dt_Customer <- as.character(marketing_campaign$Dt_Customer)
marketing_campaign$Income <- ifelse(is.na(marketing_campaign$Income), 
                                    mean(marketing_campaign$Income, na.rm = T), marketing_campaign$Income)

marketing_campaign$Dt_Customer <- as.character(marketing_campaign$Dt_Customer)

marketing_campaign$Year_Customer <- substr(marketing_campaign$Dt_Customer, 
                                  nchar(marketing_campaign$Dt_Customer) - 3, 
                                  nchar(marketing_campaign$Dt_Customer))

marketing_campaign$Dt_Customer <- NULL
marketing_campaign$ID <- NULL

marketing_campaign$Year_Customer <- as.factor(marketing_campaign$Year_Customer)

marketing_campaign$Z_CostContact <- NULL
marketing_campaign$Z_Revenue <- NULL

summary(marketing_campaign)

marketing_campaign_dummies <- as.data.frame(model.matrix(~ . -1, data = marketing_campaign))

minmax <- function(x){
  (x - min(x))/(max(x) - min(x))
}

marketing_s <- as.data.frame(lapply(marketing_campaign_dummies, minmax))


```


##Step 4 - Train/Split the Data
```{r}
train_ratio <- 0.5
set.seed(12345)
train_rows <- sample(1:nrow(marketing_s), train_ratio*nrow(marketing_s))

marketing_train <- marketing_s[train_rows, ]
marketing_test <- marketing_s[-train_rows, ]
```


##Step 5 - Build ANN Model

```{r, cache = TRUE}
library(nnet)
set.seed(12345)
ann_base <- neuralnet(Response ~ ., data = marketing_train, lifesign = "full", stepmax = 1e8, hidden = c(2,2))

ann_base_plot <- plot(ann_base)
```

##Step 6 - Prediction and Accuracy

```{r}
ann_base_pred <- predict(ann_base, marketing_test)
summary(ann_base_pred)

ann_bin_pred <- ifelse(ann_base_pred >= 0.5, 1, 0)

ann_base_matrix <- confusionMatrix(as.factor(ann_bin_pred), as.factor(marketing_test$Response), positive = "1")
ann_base_matrix
```

And now we will try to improve the ANN Model by increasing the number of hidden layers and neurons in there.

## Step 5.2 Build ANN Advance Model
```{r, cache = TRUE}
set.seed(12345)
ann_advance <- neuralnet(Response ~ ., data = marketing_train, lifesign = "full", stepmax = 1e8, hidden = c(4,4))

ann_advance_plot <- plot(ann_advance)
```

## Step 6.2 Ann Advance Model Prediction 
```{r}
ann_advance_pred <- predict(ann_advance, marketing_test)
summary(ann_advance_pred)

ann_adv_bin_pred <- ifelse(ann_advance_pred >= 0.5, 1, 0)

ann_advance_matrix <- confusionMatrix(as.factor(ann_adv_bin_pred), as.factor(marketing_test$Response), positive = "1")
ann_advance_matrix
```
Because the result of all metrics of the base model with 2 layers and 2 neurons are much better than the "advance" model. We will be using the advance model for the final second level model.

```{r}
sigmoid <- function(x) {
  1 / (1 + exp(-x))
}

ann_probs <- sigmoid(ann_base_pred)
```













